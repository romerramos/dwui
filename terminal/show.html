<div id="terminal" class="w-full h-full" data-container-id="{{.ContainerID}}"></div>
        
<script>
    const terminalElement = document.getElementById("terminal")

    const containerId = terminalElement.dataset.containerId
    
    // Initialize xterm.js
    const terminal = new Terminal({
        cursorBlink: true,
        fontFamily: 'JetBrains Mono, Fira Code, Courier New, monospace',
        fontSize: 14,
        lineHeight: 1.2,
        theme: {
            background: '#1e2939',
            foreground: '#ffffff',
            cursor: '#ffffff',
            selection: '#ffffff40',
            black: '#000000',
            red: '#ff5555',
            green: '#50fa7b',
            yellow: '#f1fa8c',
            blue: '#bd93f9',
            magenta: '#ff79c6',
            cyan: '#8be9fd',
            white: '#bfbfbf'
        }
    });

    const fitAddon = new FitAddon.FitAddon();
    terminal.loadAddon(fitAddon);
    terminal.open(terminalElement);
    fitAddon.fit();

    // // Status elements
    // const statusElement = document.getElementById('status');

    // function updateStatus(status) {
    //     const statusClasses = {
    //         'connecting': 'bg-yellow-500',
    //         'connected': 'bg-green-500',
    //         'disconnected': 'bg-red-500'
    //     };
        
    //     statusElement.className = `w-3 h-3 rounded-full mr-3 ${statusClasses[status]}`;
    // }

    // WebSocket connection
    let socket;
    let isConnected = false;

    function connectWebSocket() {
        //updateStatus('connecting');
        
        const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
        const wsUrl = `${protocol}//${window.location.host}/terminal/${containerId}`;
        
        socket = new WebSocket(wsUrl);

        socket.onopen = function(event) {
            console.log('WebSocket connected');
            isConnected = true;
            //updateStatus('connected');
            terminal.writeln('\x1b[32mConnected to container terminal...\x1b[0m\r\n');
        };

        socket.onmessage = function(event) {
            terminal.write(event.data);
        };

        socket.onclose = function(event) {
            console.log('WebSocket disconnected');
            isConnected = false;
            //updateStatus('disconnected');
            terminal.writeln('\r\n\x1b[31mConnection lost. Attempting to reconnect...\x1b[0m');
            
            // Attempt to reconnect after 3 seconds
            setTimeout(connectWebSocket, 3000);
        };

        socket.onerror = function(error) {
            console.error('WebSocket error:', error);
            //updateStatus('disconnected');
            terminal.writeln('\r\n\x1b[31mConnection error occurred.\x1b[0m');
        };
    }

    // Send terminal input to WebSocket
    terminal.onData(function(data) {
        if (isConnected && socket.readyState === WebSocket.OPEN) {
            socket.send(data);
        }
    });

    // Handle window resize
    window.addEventListener('resize', function() {
        fitAddon.fit();
    });

    // Start connection
    connectWebSocket();

    // Handle page visibility for reconnection
    document.addEventListener('visibilitychange', function() {
        if (!document.hidden && !isConnected) {
            connectWebSocket();
        }
    });
</script>
    
